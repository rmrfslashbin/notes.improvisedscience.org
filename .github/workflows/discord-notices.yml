name: Discord Notification
on:
  # Repository activity events
  push:
  pull_request:
    types: [opened, closed, reopened, assigned, unassigned, review_requested, review_request_removed, ready_for_review, converted_to_draft, edited, synchronized]
  pull_request_review:
    types: [submitted, edited, dismissed]
  pull_request_review_comment:
    types: [created, edited, deleted]
  issues:
    types: [opened, edited, deleted, transferred, pinned, unpinned, closed, reopened, assigned, unassigned, labeled, unlabeled, locked, unlocked, milestoned, demilestoned]
  issue_comment:
    types: [created, edited, deleted]
  
  # Status and security monitoring
  workflow_dispatch:  # For manual triggers
  workflow_run:
    types: [completed, requested] # To monitor other workflows
  repository_dispatch: # For custom webhook events
  check_run:
    types: [created, completed, rerequested, requested_action]
  check_suite:
    types: [completed]
  status: # Commit status updates
  
  # Repository changes
  watch:
    types: [started]
  fork:
  create:  # Branch or tag creation
  delete:  # Branch or tag deletion
  release:
    types: [published, edited, deleted, prereleased, released, created]
  registry_package:
    types: [published, updated]
  page_build:
  project:
    types: [created, updated, closed, reopened, deleted]
  project_card:
    types: [created, updated, moved, converted, deleted]
  project_column:
    types: [created, updated, moved, deleted]
  public:  # Repository made public
  
  # Discussion events
  discussion:
    types: [created, edited, deleted, transferred, pinned, unpinned, labeled, unlabeled, locked, unlocked, answered, unanswered, category_changed]
  discussion_comment:
    types: [created, edited, deleted]
  
  # Deployment events
  deployment_status:
  deployment:
  
  # Member events
  member:
    types: [added, edited, removed]
  
  # Repository management
  repository:
    types: [created, deleted, archived, unarchived, edited, renamed, transferred]

jobs:
  discord_notification:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Set event details
        id: details
        run: |
          echo "EVENT_TYPE=${{ github.event_name }}" >> $GITHUB_ENV
          
          # Status Events
          if [ "${{ github.event_name }}" = "check_run" ]; then
            echo "TITLE=ðŸ” Check Run Update" >> $GITHUB_ENV
            echo "DESC=Check run '${{ github.event.check_run.name }}' ${{ github.event.action }}" >> $GITHUB_ENV
          elif [ "${{ github.event_name }}" = "check_suite" ]; then
            echo "TITLE=ðŸ“‹ Check Suite Complete" >> $GITHUB_ENV
            echo "DESC=Check suite ${{ github.event.check_suite.conclusion }}" >> $GITHUB_ENV
          elif [ "${{ github.event_name }}" = "status" ]; then
            echo "TITLE=ðŸ“Š Status Update" >> $GITHUB_ENV
            echo "DESC=Status: ${{ github.event.state }}" >> $GITHUB_ENV
          
          # Workflow and Deployment Events
          elif [ "${{ github.event_name }}" = "workflow_run" ]; then
            echo "TITLE=âš¡ Workflow Status" >> $GITHUB_ENV
            echo "DESC=Workflow '${{ github.event.workflow_run.name }}' ${{ github.event.action }} with status: ${{ github.event.workflow_run.conclusion }}" >> $GITHUB_ENV
          elif [ "${{ github.event_name }}" = "deployment_status" ]; then
            echo "TITLE=ðŸš€ Deployment Update" >> $GITHUB_ENV
            echo "DESC=Deployment ${{ github.event.deployment_status.state }}" >> $GITHUB_ENV
          
          # Repository Events
          elif [ "${{ github.event_name }}" = "push" ]; then
            echo "TITLE=ðŸ”¨ New Push" >> $GITHUB_ENV
            echo "DESC=New commits pushed by ${{ github.actor }}" >> $GITHUB_ENV
          elif [ "${{ github.event_name }}" = "pull_request" ]; then
            echo "TITLE=ðŸ”„ Pull Request" >> $GITHUB_ENV
            echo "DESC=PR #${{ github.event.number }} ${{ github.event.action }} by ${{ github.event.pull_request.user.login }}" >> $GITHUB_ENV
          elif [ "${{ github.event_name }}" = "pull_request_review" ]; then
            echo "TITLE=ðŸ‘€ PR Review" >> $GITHUB_ENV
            echo "DESC=Review ${{ github.event.action }} on PR #${{ github.event.pull_request.number }}" >> $GITHUB_ENV
          elif [ "${{ github.event_name }}" = "issues" ]; then
            echo "TITLE=ðŸ“ Issue Update" >> $GITHUB_ENV
            echo "DESC=Issue #${{ github.event.issue.number }} ${{ github.event.action }} by ${{ github.event.issue.user.login }}" >> $GITHUB_ENV
          elif [ "${{ github.event_name }}" = "issue_comment" ]; then
            echo "TITLE=ðŸ’¬ New Comment" >> $GITHUB_ENV
            echo "DESC=New comment on #${{ github.event.issue.number }} by ${{ github.event.comment.user.login }}" >> $GITHUB_ENV
          elif [ "${{ github.event_name }}" = "discussion" ]; then
            echo "TITLE=ðŸ’¡ Discussion" >> $GITHUB_ENV
            echo "DESC=Discussion ${{ github.event.action }} by ${{ github.event.sender.login }}" >> $GITHUB_ENV
          
          # Repository Management
          elif [ "${{ github.event_name }}" = "watch" ]; then
            echo "TITLE=â­ New Star" >> $GITHUB_ENV
            echo "DESC=${{ github.actor }} starred the repository" >> $GITHUB_ENV
          elif [ "${{ github.event_name }}" = "fork" ]; then
            echo "TITLE=ðŸ´ New Fork" >> $GITHUB_ENV
            echo "DESC=${{ github.actor }} forked the repository" >> $GITHUB_ENV
          elif [ "${{ github.event_name }}" = "release" ]; then
            echo "TITLE=ðŸ“¦ New Release" >> $GITHUB_ENV
            echo "DESC=Version ${{ github.event.release.tag_name }} has been ${{ github.event.action }}" >> $GITHUB_ENV
          elif [ "${{ github.event_name }}" = "registry_package" ]; then
            echo "TITLE=ðŸ“¨ Package Update" >> $GITHUB_ENV
            echo "DESC=Package ${{ github.event.action }}" >> $GITHUB_ENV
          elif [ "${{ github.event_name }}" = "project" ]; then
            echo "TITLE=ðŸ“‹ Project Update" >> $GITHUB_ENV
            echo "DESC=Project ${{ github.event.action }}" >> $GITHUB_ENV
          elif [ "${{ github.event_name }}" = "repository" ]; then
            echo "TITLE=ðŸ“š Repository Update" >> $GITHUB_ENV
            echo "DESC=Repository ${{ github.event.action }}" >> $GITHUB_ENV
          
          # Member Events
          elif [ "${{ github.event_name }}" = "member" ]; then
            echo "TITLE=ðŸ‘¥ Member Update" >> $GITHUB_ENV
            echo "DESC=Member ${{ github.event.member.login }} ${{ github.event.action }}" >> $GITHUB_ENV
          
          # Default case
          else
            echo "TITLE=ðŸ“¢ Repository Update" >> $GITHUB_ENV
            echo "DESC=${{ github.event_name }} event triggered by ${{ github.actor }}" >> $GITHUB_ENV
          fi

      - name: Send Discord Notification
        uses: sarisia/actions-status-discord@v1
        with:
          webhook: ${{ secrets.DISCORD_WEBHOOK }}
          title: ${{ env.TITLE }}
          description: ${{ env.DESC }}
          color: 0x0099ff
          username: GitHub Bot
          avatar_url: https://github.githubassets.com/images/modules/logos_page/GitHub-Mark.png
          noprefix: true
          fields: |
            [
              {
                "name": "Repository",
                "value": "[${{ github.repository }}](https://github.com/${{ github.repository }})",
                "inline": true
              },
              {
                "name": "Event",
                "value": "${{ env.EVENT_TYPE }}",
                "inline": true
              },
              {
                "name": "Triggered By",
                "value": "[${{ github.actor }}](https://github.com/${{ github.actor }})",
                "inline": true
              }
            ]
